<?php

require_once 'PHPUnit/Autoload.php';
require_once __DIR__.'/../pen.php';

class TestModelTest extends PHPUnit_Framework_TestCase {
	function testPen() {

		// инициализируем класс
		$fp = fopen(__DIR__.'/pen_output.html','w');
		fwrite($fp,'<html><body>'."\r\n");
		$pen = new pen\pen($fp,'blue');

		// проверим что-нибудь
		$this->assertEquals($pen->getInkResidue(),pen\pen::FULL_INK_VALUE);
		$this->assertEquals($pen->getInkResiduePercent(),1);

		// попробуем писать
		$text = 'SOME TEXT SOME TEXT SOME TEXT SOME TEXT SOME TEXT SOME TEXT SOME TEXT SOME TEXT';
		$this->assertEquals($pen->write($text),strlen($text));
		$this->assertEquals($pen->getInkResidue(),pen\pen::FULL_INK_VALUE-strlen($text));

		// попробуем использовать всю пасту
		$written = strlen($text);
		$i = 0;
		do{
			$res=$pen->write($text);
			$written+=$res;

			// защита от бесконечного цикла
			$i++;
			if($i>500)
				break;
		}while($res>0 || $written<=pen\pen::FULL_INK_VALUE);

		$this->assertEquals($pen->getInkResidue(),0);
		$this->assertEquals($pen->getInkResiduePercent(),0.0);

		// завершение
		fwrite($fp,'</body></html>');
		fclose($fp);
	}

}